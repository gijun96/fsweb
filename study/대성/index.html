<?php 
	header('Content-Type: text/html; charset=utf-8;');
	$connect=mysqli_connect("localhost","root","msd11047103!","notic_db");
	$query2 =
  "select NAME,DESTINATION,date_format(STARTTIME,'%m-%d-%H:%i')as STARTTIME,date_format(RETURNTIME,'%m-%d-%H:%i') as RETURNTIME,PURPOSE,REMARK FROM board_db ORDER BY STARTTIME asc;";
	$result2 = mysqli_query($connect,$query2);
?>
<!doctype html>
<head>
<meta charset="UTF-8">
<meta name="viewport" cotent="width=device-width, initial-scale=1">
<!--<link rel=stylesheet href='css/style.css' type='text/css'>-->
<link rel=stylesheet href='css/notic_style.css' type='text/css'>
<script src="js/code.jquery.com_jquery-3.7.0.min.js"></script>
<title>게시판</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" intergrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>

<script>
/**setInterval(function(){
  $("#board_area").load(location.href+" #board_area","");
}, 5000);**/

function updateTableCaption() {
  $.ajax({
    url: 'update_table_caption.php', // 새로운 캡션을 가져올 PHP 파일의 경로를 지정합니다.
    type: 'GET',
    dataType: 'html',
    success: function(response) {
      $('#table_cap_area').html(response); // #table_cap_area를 업데이트합니다.
    },
    error: function() {
      alert('데이터를 가져오는 동안 오류가 발생했습니다.');
    }
  });
}

updateTableCaption(); // 페이지 로드 시 한 번 업데이트합니다.

setInterval(function() {
  updateTableCaption(); // 24시간마다 업데이트합니다.
}, 12000*60*60); // 12시간을 밀리초로 계산한 값(확인필요)

function updateData(){
	$.ajax({
	url: 'update_data_index.php',
	type: 'GET',
	dataType:'html',
	success: function(response){
		$('.result_table').html(response);
	},
	error: function(){
	 alert('데이터를 가져오는 동안 오류가 발생했습니다.');
	}
	});
}

updateData();

setInterval(function(){
	updateData();
},5000);


function printClock() {

    var clock = document.getElementById("clock");     
    var currentDate = new Date(); // 현재시간
    var calendar = currentDate.getFullYear() + "-" + (currentDate.getMonth()+1) + "-" + currentDate.getDate() // 현재 날짜
    //var amPm = 'AM'; // 초기값 AM
    var currentHours = addZeros(currentDate.getHours(),2); 
    var currentMinute = addZeros(currentDate.getMinutes() ,2);
    var currentSeconds =  addZeros(currentDate.getSeconds(),2);
    
   /* if(currentHours >= 12){ // 시간이 12보다 클 때 PM으로 세팅, 12를 빼줌
    	amPm = 'PM';
    	currentHours = addZeros(currentHours - 12,2);
}*/

    if(currentSeconds >= 50){// 50초 이상일 때 색을 변환해 준다.
       currentSeconds = '<span style="color:#de1951;">'+currentSeconds+'</span>'
}
    var timeFormat = currentHours + ":" + currentMinute + ":" + currentSeconds;
    /* clock.innerHTML = currentHours+":"+currentMinute+":"+currentSeconds +" <span style='font-size:50px;'>"+ amPm+"</span>"; */

    clock.innerHTML = timeFormat;

    setTimeout("printClock()",1000);         // 1초마다 printClock() 함수 호출
}

function addZeros(num, digit) { // 자릿수 맞춰주기
	  var zero = '';
	  num = num.toString();
	  if (num.length < digit) {
	    for (i = 0; i < digit - num.length; i++) {
	      zero += '0';
	    }
	  }
	  return zero + num;
}

(function(d, s, id) {
            if (d.getElementById(id)) {
                if (window.__TOMORROW__) {
                    window.__TOMORROW__.renderWidget();
                }
                return;
            }
            const fjs = d.getElementsByTagName(s)[0];
            const js = d.createElement(s);
            js.id = id;
            js.src = "https://www.tomorrow.io/v1/widget/sdk/sdk.bundle.min.js";

            fjs.parentNode.insertBefore(js, fjs);
        })(document, 'script', 'tomorrow-sdk');

</script>

<div class="wrap">
	<div class="top_logo">
		<img src="css/logo/대성회사로고사이즈다운.png" class="img-fluid"  alt="Logo Image">
	</div>
	<div id="main_fram" class="table-responsive ">
	<div class="w_h_info"> 
	  	<div id="table_cap_area">
	   	</div>

		 <div class="tomorrow"
           data-location-id="065488"
           data-language="KO"
           data-unit-system="METRIC"
           data-skin="light"
           data-widget-type="upcoming"
           style="padding-bottom:22px;position:relative;"
        >
          <a
            href="https://www.tomorrow.io/weather-api/"
            rel="nofollow noopener noreferrer"
            target="_blank"
            style="position: absolute; bottom: 0; transform: translateX(-50%); left: 50%;"
          >
            <img
              alt="Powered by the Tomorrow.io Weather API"
              src="https://weather-website-client.tomorrow.io/img/powered-by.svg"
              width="250"
              height="18"
            />
          </a>
        </div>
	</div>


	<body onload="printClock()">
	<div style="width:600px; height:100px; line-height:100px; color:#666;font-size:60px; text-align:center; font-weight:bolder;" id="clock">
	</div>
	<div id="board_area">
		<table class="table border-bottom border-secondary">
			<thead>
				<tr>
					<th>이름</th>
					<th>행선지</th>
					<th>출발시간</th>
					<th>귀사예정시간</th>
					<th>용무</th>
					<th>비고</th>
				</tr>
			</thead>
			
			<tbody class ="result_table">
			</tbody>
		</table>
			</div>
		</div>
	</div>
</body>
</html>
